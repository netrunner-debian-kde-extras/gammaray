From: Jakub Adam <jakub.adam@ktknet.cz>
Date: Wed, 5 Sep 2012 20:04:22 +0200
Subject: dont-build-functionoverwriter

---
 core/CMakeLists.txt |   15 ++++++++++-----
 core/probe.cpp      |    2 ++
 2 files changed, 12 insertions(+), 5 deletions(-)

diff --git a/core/CMakeLists.txt b/core/CMakeLists.txt
index 6aadfbf..10d81e3 100644
--- a/core/CMakeLists.txt
+++ b/core/CMakeLists.txt
@@ -53,11 +53,6 @@ set(gammaray_srcs
   propertyeditor/propertypaletteeditor.cpp
   propertyeditor/palettedialog.cpp
 
-  hooking/abstractfunctionoverwriter.cpp
-  hooking/functionoverwriterfactory.cpp
-  hooking/winfunctionoverwriter.cpp
-  hooking/unixfunctionoverwriter.cpp
-
   tools/modelinspector/modeltester.cpp
   tools/modelinspector/modelmodel.cpp
   tools/modelinspector/modelcellmodel.cpp
@@ -105,6 +100,16 @@ set(gammaray_srcs
   tools/styleinspector/dynamicproxystyle.cpp
 )
 
+if(WIN32 OR APPLE)
+  set(gammaray_srcs
+    ${gammaray_srcs}
+    hooking/abstractfunctionoverwriter.cpp
+    hooking/functionoverwriterfactory.cpp
+    hooking/winfunctionoverwriter.cpp
+    hooking/unixfunctionoverwriter.cpp
+  )
+endif()
+
 if(HAVE_PRIVATE_QT_HEADERS)
   set(gammaray_srcs
     ${gammaray_srcs}
diff --git a/core/probe.cpp b/core/probe.cpp
index dafeb23..be32b8b 100644
--- a/core/probe.cpp
+++ b/core/probe.cpp
@@ -711,6 +711,7 @@ Q_DECL_EXPORT const char *myFlagLocation(const char *method)
 }
 #endif
 
+#if defined(Q_OS_WIN) || defined(Q_OS_MAC)
 void overwriteQtFunctions()
 {
   functionsOverwritten = true;
@@ -739,6 +740,7 @@ void overwriteQtFunctions()
 #endif
 #endif
 }
+#endif
 
 #ifdef Q_OS_WIN
 extern "C" Q_DECL_EXPORT void gammaray_probe_inject();
